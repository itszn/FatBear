<html>
<style>
html {
  background-color: #59DFE8;
}
body {
  margin: 0;
  width: 100%;
}

div.bg {
  height: 100vmin;
  display: block;
  margin-left: auto;
  margin-right: auto;
  position: relative;
}
.over {
  box-shadow: 0 0 20px 20px #59dfe8 inset;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}
.bg > img {
  height: 100vmin;
  width: auto;
  display: block;
}
.content {
  width: 100%;
  height: 100%;
  position: relative;
  display: flex;
}
.profile {
  position: absolute;
  width: 6%;
  height: 8.8%;
  cursor: pointer;
}
.winner {
  position: absolute;
  width: 9%;
}
.score {
  position: absolute;
  width: 20%;
  text-align: center;
  color: #7f1eff;
  font-size: 20pt;
  font-family: sans-serif;
}
</style>
  <body>
    <div class="content">
      <div class="bg">
        <img class="bg" src="./bg.jpg"/>
        <div class="over"></div>
        <div class="profile" data-name="Holly" data-link="https://media.explore.org/documents/435holly-beforeafter-1632778278471.png" style="
          left: 7.5%;
          top: 2.6%;
        "></div>
        <div class="profile" data-name="Grazer" data-link="https://media.explore.org/documents/128grazer-beforeafter-1632778787221.png" style="
          left: 7.5%;
          top: 19.6%;
        "></div>
        <div class="profile" data-name="Popeye" data-link="https://media.explore.org/documents/634-beforeafter-1632778360782.png" style="
          left: 7.5%;
          top: 60.3%;
        "></div>
        <div class="profile" data-name="Walker" data-link="https://media.explore.org/documents/151walker-beforeafter-1632778228964.png" style="
          left: 7.5%;
          top: 77.6%;
        "></div>
        <div class="profile" data-name="Cub" data-link="https://media.explore.org/documents/132-spring-cub-beforeafter-1632778196432.png" style="
          left: 16.6%;
          top: 33.5%;
        "></div>
        <div class="profile" data-name="Chunk" data-link="https://media.explore.org/documents/32chunk-beforeafter-1632778069052.png" style="
          left: 16.6%;
          top: 46.5%;
        "></div>

        <div class="profile" data-name="812" data-link="https://media.explore.org/documents/812-beforeafter-1632778421957.png" style="
          left: 86.7%;
          top: 2.7%;
          background-color: #59dfe8;
          opacity: 0.6;
        "></div>
        <div class="profile" data-name="131" data-link="https://media.explore.org/documents/131-beforeafter-1632778809698.png" style="
          left: 86.5%;
          top: 19.6%;
        "></div>
        <div class="profile" data-name="402" data-link="https://media.explore.org/documents/402-beforeafter-1632778251877.png" style="
          left: 86.5%;
          top: 60.3%;
        "></div>
        <div class="profile" data-name="Otis" data-link="https://media.explore.org/documents/480otis-beforeafter-1632778305141.png" style="
          left: 86.5%;
          top: 77.6%;
        "></div>
        <div class="profile" data-name="503" data-link="https://media.explore.org/documents/503-beforeafter-1632778334865.png" style="
          left: 77.5%;
          top: 33.5%;
        "></div>
        <div class="profile" data-name="747" data-link="https://media.explore.org/documents/747-beforeafter-1632778384653.png" style="
          left: 77.5%;
          top: 46.5%;
        "></div>

        <div class="winner" style="
          left: 23%;
          top: 15.5%;
          "></div>
        <div class="winner" style="
          left: 23%;
          top: 68%;
          "></div>
        <div class="winner" style="
          left: 68%;
          top: 15.5%;
          "></div>
        <div class="winner" style="
          left: 68%;
          top: 68%;
          "></div>

        <div class="winner" style="
          left: 32%;
          top: 27%;
          "></div>
        <div class="winner" style="
          left: 32%;
          top: 55.5%;
          "></div>
        <div class="winner" style="
          left: 59%;
          top: 27%;
          "></div>
        <div class="winner" style="
          left: 59%;
          top: 55.5%;
          "></div>

        <div class="winner" style="
          left: 42%;
          top: 31%;
          "></div>
        <div class="winner" style="
          left: 49%;
          top: 51%;
          "></div>

        <div class="winner" style="
          left: 43%;
          top: 75%;
          width: 14%;
          "></div>

        <div class="score" style="
          left: 40%;
          top: 83.5%;
          ">0 Bracket Points</div>

      </div>
    </div>
  <script>
let bracket = [
  '10',
  [
    '8',
    [
      '4',
      ['0', 0, 1, null,1],
      4,
      null,4
    ],
    [
      '5',
      5,
      ['1', 2, 3, null,3],
      null,3
    ],
    null,3
  ],
  [
    '9',
    [
      '6',
      ['2', 6, 7, null,6],
      10,
      null,6
    ],
    [
      '7',
      11,
      ['3', 8, 9, null,9],
      null,9
    ],
    null,9
  ],
  null,null
];

$ = (...args)=>Array.from(document.querySelectorAll.apply(document, args));
let profs = $('.profile')
let bears = {none:'???'};


profs.map((v,i)=>{
  v.addEventListener('click',()=>{
    window.open(v.dataset.link);
  })
  bears[i] = v.dataset.name;
});

let winners = {};
let groups = {};

$('.winner').map((w,i)=>{
  winners[`${i}`] = w;
});

let saved_groups = localStorage.getItem('groups');
if (saved_groups === null)
  saved_groups = groups;
else
  saved_groups = JSON.parse(saved_groups);

let score = 0;
let get_guess = (g) => typeof(g) == 'object'? g[3] : g;
let make_group = (g, depth) =>{
  console.log(g);
  let [id, a, b, guess, real] = g;
  groups[id] = g;

  guess = saved_groups[id][3];
  g[3] = guess;

  let w = winners[id];
  let a_val = a;
  let b_val = b;

  if (real === -1)
    real = null;

  if (typeof(a) !== 'number') {
    a_val = make_group(a, depth-1);
    if (guess == a_val && a[4] !== null && a[4] != guess) {
      real = -1;
    }
  }
  if (typeof(b) !== 'number') {
    b_val = make_group(b, depth-1);
    if (guess == b_val && b[4] !== null && b[4] != guess) {
      real = -1;
    }
  }
  g[4] = real;

  if (guess !== null && real == guess) {
    score += 2**depth;
  }

  if (w !== undefined) {
    let has_both = a !== 'none' && b !== 'none';
    w.innerHTML = `<select style="
      width: 100%;
      ${!has_both?'background-color: #c1c1c1;':''}
      ${guess!==null?(
        (real === null || guess == real)?
        (real !== null?
         'background-color: #3ce870;':
         'background-color: #a3f9ff;'
        ):
        'background-color: #FF3C3C; color: white;'
      ):''}
    ">
      <option>SELECT</option>
      <option ${(a_val == guess)?'selected':''}>${bears[a_val]}</option>
      <option ${(b_val == guess)?'selected':''}>${bears[b_val]}</option>
    </select>`
  }
  if (guess === null)
    return 'none';
  return guess.toString();
}
let update = () => {
  score = 0;
  make_group(bracket, 3);
  $('select').map((v,i)=>{
    v.addEventListener('change',() => {
      if (v.selectedIndex === 0)
        groups[i][3] = null;
      else
        groups[i][3] = get_guess(groups[i][v.selectedIndex]);
      localStorage.setItem('groups',JSON.stringify(groups));
      saved_groups = groups;
      update();
    });
  });
  $('.score')[0].innerText = `${score} Bracket Point${score!==1?'s':''}`;
}
update();
  </script>
  </body>
</html>
